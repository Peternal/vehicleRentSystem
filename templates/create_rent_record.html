<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Create Rent Record</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesdesign" name="author">

        <!-- Bootstrap Css -->
        <link href="../static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="../static/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="../static/css/app.min.css" rel="stylesheet" type="text/css">
        <!-- alertifyjs Css -->
        <link href="../static/css/alertify.min.css" rel="stylesheet" type="text/css">

        <!-- alertifyjs default themes  Css -->
        <link href="../static/css/default.min.css" rel="stylesheet" type="text/css">


        <style type="text/css">            
            .list-group {
                display: none;
            }
        </style>

    </head>

    <body data-topbar="colored" onload="timenow()">

        <!-- Begin page -->
        <div id="layout-wrapper">

            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-24 header-item waves-effect" id="vertical-menu-btn">
                            <i class="mdi mdi-backburger"></i>
                        </button>

                        
                    </div>

                    <div class="d-flex">

                        <div class="dropdown d-inline-block d-lg-none ml-2">
                            <button type="button" class="btn header-item noti-icon waves-effect" id="page-header-search-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="mdi mdi-magnify"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right p-0" aria-labelledby="page-header-search-dropdown">
                    
                                <form class="p-3">
                                    <div class="form-group m-0">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="submit"><i class="mdi mdi-magnify"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
            
                        

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="d-none d-sm-inline-block ml-1">Smith</span>
                                <i class="mdi mdi-chevron-down d-none d-sm-inline-block"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <!-- item-->
                                <a class="dropdown-item" href="#"><i class="mdi mdi-face-profile font-size-16 align-middle mr-1"></i> Profile</a>
                                <a class="dropdown-item" href="#"><i class="mdi mdi-credit-card-outline font-size-16 align-middle mr-1"></i> Billing</a>
                                <a class="dropdown-item" href="#"><i class="mdi mdi-account-settings font-size-16 align-middle mr-1"></i> Settings</a>
                                <a class="dropdown-item" href="#"><i class="mdi mdi-lock font-size-16 align-middle mr-1"></i> Lock screen</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#"><i class="mdi mdi-logout font-size-16 align-middle mr-1"></i> Logout</a>
                            </div>
                        </div>
            
                    </div>
                </div>

            </header>

            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">

                <div data-simplebar="" class="h-100">

                    <!--- Sidemenu -->
                    <div id="sidebar-menu">
                        <!-- Left Menu Start -->
                        <ul class="metismenu list-unstyled" id="side-menu">
                            <li class="menu-title">Menu</li>

                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-table"></i></div>
                                    <span>Rent Records</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="/rent_record">Rent Records</a></li>
                                    <li><a href="">Create Rent Record</a></li>
                                </ul>
                            </li>



                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-vector-square"></i></div>
                                    <span>Vehicle</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="/vehicle">Vehicle</a></li>
                                    <li><a href="/vehicle_class">Vehicle Class</a></li>
                                </ul>
                            </li>

                            <li>
                                <a href="javascript: void(0);" class="has-arrow waves-effect">
                                    <div class="d-inline-block icons-sm mr-1"><i class="uim uim-chart-pie"></i></div>
                                    <span>Coupon</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li><a href="/indi_coupon">Indi Customer Coupon</a></li>
                                    <li><a href="/corp_coupon">Corp Customer Coupon</a></li>
                                </ul>
                            </li>

                        </ul>

                    </div>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">

                    <!-- Page-Title -->
                    <div class="page-title-box">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4 class="page-title mb-1">Create Rent Record</h4>
                                </div>
                                <div class="col-md-4">
                                    <div class="float-right d-none d-md-block">
                                        <div class="dropdown">
                                            <button class="btn btn-light btn-rounded dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="mdi mdi-settings-outline mr-1"></i> Settings
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-animated">
                                                <a class="dropdown-item" href="#">Action</a>
                                                <a class="dropdown-item" href="#">Another action</a>
                                                <a class="dropdown-item" href="#">Something else here</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item" href="#">Separated link</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- end page title end breadcrumb -->

                    <div class="page-content-wrapper">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                    
                                            
                                            <div class="form-group row align-items-center">
                                                <label class="col-md-2 col-form-label">Pickup Office</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <select name="pickup_office" class="form-control" id="pickup_office_id">
                                                            {% for j in officelist %}
                                                                <option value="{{j['office_id']}}">{{j['office_name']}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group row align-items-center">
                                                <label class="col-md-2 col-form-label">Dropoff Office</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <select name="dropoff_office" class="form-control" id="dropoff_office_id">
                                                            {% for j in officelist %}
                                                                <option value="{{j['office_id']}}">{{j['office_name']}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row align-items-center">
                                                <label for="pickup_date" class="col-md-2 col-form-label">Pickup Date</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="date"  id="pickup_date">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row align-items-center">
                                                <label for="dropoff_date" class="col-md-2 col-form-label">Dropoff Date</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="date" value="" id="dropoff_date">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row align-items-center">
                                                <label for="start_meter" class="col-md-2 col-form-label">Start Meter</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="number" min="0" max="9999999999" maxlength="10" id="start_meter" onkeydown="return event.keyCode !== 69 && event.keyCode !== 189 && event.keyCode !== 109 && event.keyCode !== 107 && event.keyCode !== 187 && event.keyCode !== 190 && event.keyCode !== 110" style="ime-mode:disabled" onBlur="javascript: if (this.value!='0') {this.value=this.value.replace(/(^0*)/g, '')};" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="form-group row align-items-center">
                                                <label for="end_meter" class="col-md-2 col-form-label">End Meter</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="number" min="0" max="9999999999" maxlength="10" id="end_meter" onkeydown="return event.keyCode !== 69 && event.keyCode !== 189 && event.keyCode !== 109 && event.keyCode !== 107 && event.keyCode !== 187 && event.keyCode !== 190 && event.keyCode !== 110" style="ime-mode:disabled" onBlur="javascript: if (this.value!='0') {this.value=this.value.replace(/(^0*)/g, '')};" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row align-items-center">
                                                <label for="limit_meter" class="col-md-2 col-form-label">Daily Meter Limit</label>
                                                <div class="col-auto">
                                                    <div class="mt-3 mr-sm-2">
                                                        <label class="sr-only" for="limit_meter">Limited</label>
                                                        <input type="number" class="form-control mb-2" id="limit_meter" min="0" max="99999" maxlength="5" onkeydown="return event.keyCode !== 69 && event.keyCode !== 189 && event.keyCode !== 109 && event.keyCode !== 107 && event.keyCode !== 187 && event.keyCode !== 190 && event.keyCode !== 110" style="ime-mode:disabled" onBlur="javascript: if (this.value!='0') {this.value=this.value.replace(/(^0*)/g, '')};" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
                                                    </div>
                                                </div>

                                                
                                                <div class="col-auto">
                                                    <div class="form-check mt-2 mr-sm-2">
                                                        <input class="form-check-input" type="checkbox" id="check_unlimit" onclick="EnableDisableTextBox(this)" >
                                                        <label class="form-check-label" for="check_unlimit">
                                                            Unlimited
                                                        </label>
                                                    </div>
                                                </div>    
                                            </div>

                                            
                                            <div class="form-group row align-items-center">
                                                <label for="email" class="col-md-2 col-form-label">Email</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="email" id="email" maxlength="30">
                                                        <ul class="list-group" id="email-list-box">

                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row align-items-center">
                                                <label for="vin" class="col-md-2 col-form-label">VIN</label>
                                                <div class="col-md-10">
                                                    <div class="mt-3 mr-sm-2">
                                                        <input class="form-control" type="text" id="vin" maxlength="17" onKeyUp="value=value.replace(/[\W]/g,'').toUpperCase()">
                                                        <ul class="list-group" id="vin-list-box">

                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>


                                            <br>

                                            <div style="text-align:center">
                                                <div class="mt-4" style="text-align:center">
                                                    <button type="submit" id="submit" class="btn btn-primary btn-lg btn-block waves-effect waves-light" onclick="submitInput()">Submit</button>
                                                </div>                    
                                            </div>

                                            


                                      </div>
                                    </div>
                                </div>
                                <!-- end col -->
                            </div>
                            <!-- end row -->


                        </div>
                        <!-- end container-fluid -->
                    </div> 
                    <!-- end page-content-wrapper -->
                </div>
                <!-- End Page-content -->

                
                
            </div>
            <!-- end main content-->

        </div>
        <!-- END layout-wrapper -->

        <!-- JAVASCRIPT -->
        <script src="../static/js/jquery.min.js"></script>
        <script src="../static/js/bootstrap.bundle.min.js"></script>
        <script src="../static/js/metisMenu.min.js"></script>
        <script src="../static/js/simplebar.min.js"></script>
        <script src="../static/js/waves.min.js"></script>

        <script src="../static/js/bundle.js"></script>

        <!-- alertifyjs js
        <script src="../static/js/alertify.min.js"></script>

        <script src="../static/js/alertifyjs.init.js"></script> -->


        <script src="../static/js/app.js"></script>


        

        <script>
              function timenow(){
                var d = new Date();
                var a = d.getFullYear() + "-";
                if (d.getMonth() + 1 >= 10 ){
                    var c = (d.getMonth() + 1) + "-";
                }
                else{
                    var c = "0" + (d.getMonth() + 1) + '-';
                }
                if (d.getDate() >= 10 ){
                      var n = d.getDate();
                }
                else{
                      var n = "0" + d.getDate();
                }
              }
              
        </script>

        <script type="text/javascript">
            function EnableDisableTextBox(chk) {
                // if unlimited is checked, disable the limit meter input
                var limitInput = document.getElementById("limit_meter");
                limitInput.disabled = chk.checked ? true : false;
                if (!limitInput.disabled) {
                    limitInput.focus();
                } else {
                    limitInput.value="";
                    limitInput.reset();
                }
            }
        </script>
      

        <script>
            function submitInput(){
                //check date
                var pickupDate = document.getElementById("pickup_date").value;
                var dropoffDate = document.getElementById("dropoff_date").value;
                if (pickupDate==""){
                    alert("Please choose pickup date!");
                    return false;
                } else if (dropoffDate==""){
                    alert("Please choose dropoff date!");
                    return false;
                } else if (pickupDate>=dropoffDate){
                    alert("Dropoff date should be later than pickup date!");
                    return false;
                }

                //check meter
                var startMeter = document.getElementById("start_meter").value;
                var endMeter = document.getElementById("end_meter").value;
                if (startMeter==""){
                    alert("Please enter start meter!");
                    return false;
                } else if (endMeter==""){
                    alert("Please enter end meter!");
                    return false;
                } else if (parseInt(startMeter)>parseInt(endMeter)){
                    alert("End meter should be larger than Start meter!");
                    return false;
                }

                //check Daily Meter Limit
                var unlimitCheck = document.getElementById("check_unlimit");
                var limitInput = document.getElementById("limit_meter").value;
                if (!unlimitCheck.checked && limitInput==""){
                    alert("Please enter daily limit meter!");
                    return false;
                }

                //check email
                var email = document.getElementById("email").value;
                var regex = /^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g;
                if (email==""){
                    alert("Please enter email!");
                    return false;
                } else if (!regex.test(email)){
                    alert("Invalid email!");
                    return false;
                }

                //check vin
                var vin = document.getElementById("vin").value;
                if (vin==""){
                    alert("Please enter VIN!");
                    return false;
                } else if (vin.length!=17){
                    alert("VIN should be 17 digits!");
                    return false;
                } 


                //get pickup/dropoff office id
                var pickupId = document.getElementById("pickup_office_id").value;
                var dropoffId = document.getElementById("dropoff_office_id").value;

                var finallimit = unlimitCheck.checked ? "-1" : limitInput;


                if (confirm("Do you want to submit this new record?")==false){
                    return false;
                }

 
                // ajax send data to backend
                $.ajax({
                    url:"/create_record_request",
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({"pickup_office_id":pickupId, "dropoff_office_id":dropoffId, "pickup_date":pickupDate, 
                                            "dropoff_date":dropoffDate, "start_meter": startMeter, "end_meter":endMeter, 
                                            "daliy_meter_limit":finallimit, "email":email, "vin":vin}),
                    success:function(data){
                        if (data.status == "success"){
                            alert(data.content);
                            window.location.reload();
                        } else {
                            alert(data.content);
                        }
                        
                    },
                    error:function(){
                        alert("Submit error...")
                    }
                });

            }
        </script>

        <!-- email hint -->
        <script>
            var searchInp_e = document.querySelector('#email')
            var listBox_e = document.querySelector('#email-list-box')
            var timer_e = null;
            // enable when user input
            searchInp_e.oninput = function() {
                // clear last timer_e
                clearTimeout(timer_e);
                // get input
                var key = this.value;
                // if no input
                if (key.trim().length == 0) {
                    // hide ul
                    listBox_e.style.display = 'none';
                    return;
                }

                // set timer_e
                timer_e = setTimeout(function() {
                    $.ajax({
                        type: 'post',
                        url: '/email_hint',
                        data: JSON.stringify({"key":key}),
                        success: function(result) {
                            var dataOptions = '';
                            if (result.code==1){ //if the result is not empty
                                for(var i = 0; i < result.content.length; i++){
                                    dataOptions += '<li onclick="get_email_li(this.innerHTML)" class="list-group-item" >';
                                    dataOptions += result.content[i].email + "</li>";
                                }
                                $("#email-list-box").html(dataOptions);
                                // show ul
                                listBox_e.style.display = 'block';
                            }
                            else{
                                //hide ul
                                listBox_e.style.display = 'none';
                            }
                            
                        }
                    })
                }, 800)

            }

        </script>

        <!-- get email in the <li> -->
        <script>
            function get_email_li(key){
                var listBox = document.querySelector('#email-list-box')
                var email = document.getElementById("email");
                email.value = key;
                //hide ul
                listBox.style.display = 'none';
            }
        </script>



        <!-- vin hint -->
        <script>
            var searchInp_v = document.querySelector('#vin')
            var listBox_v = document.querySelector('#vin-list-box')
            var timer_v = null;
            // enable when user input
            searchInp_v.oninput = function() {
                // clear last timer_v
                clearTimeout(timer_v);
                // get input
                var key = this.value;
                // if no input
                if (key.trim().length == 0) {
                    // hide ul
                    listBox_v.style.display = 'none';
                    return;
                }

                // set timer_v
                timer_v = setTimeout(function() {
                    $.ajax({
                        type: 'post',
                        url: '/vin_hint',
                        data: JSON.stringify({"key":key}),
                        success: function(result) {
                            var dataOptions = '';
                            if (result.code==1){ //if the result is not empty
                                for(var i = 0; i < result.content.length; i++){
                                    dataOptions += '<li onclick="get_vin_li(this.innerHTML)" class="list-group-item" >';
                                    dataOptions += result.content[i].vin + "</li>";
                                }
                                $("#vin-list-box").html(dataOptions);
                                // show ul
                                listBox_v.style.display = 'block';
                            }
                            else{
                                //hide ul
                                listBox_v.style.display = 'none';
                            }
                            
                        }
                    })
                }, 800)

            }

        </script>

        <!-- get vin in the <li> -->
        <script>
            function get_vin_li(key){
                var listBox = document.querySelector('#vin-list-box')
                var vin = document.getElementById("vin");
                vin.value = key;
                //hide ul
                listBox.style.display = 'none';
            }
        </script>



        
        

    </body>
</html>
